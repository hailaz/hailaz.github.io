<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>vue</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <style type="text/css">
        .point {
            color: rgb(255, 255, 255);
            font-size: 1px;
            float: left;
            border: 1px solid white;
            list-style: none;
            text-align: center;
            background-color: white;
        }

        .pointSelect {
            background: -webkit-linear-gradient(left top, black, white);
            /* Safari 5.1 - 6.0 */
            background: -o-linear-gradient(bottom right, black, white);
            /* Opera 11.1 - 12.0 */
            background: -moz-linear-gradient(bottom right, black, white);
            /* Firefox 3.6 - 15 */
            background: rgb(219, 71, 71)
                /*linear-gradient(to bottom right, black, yellow);*/
                /* 标准的语法 */
        }
    </style>
</head>

<body>
    <div id="snakeId" :style="snakeBoxStyle">
        <snake-point :style="snakePointStyle" v-for="item in snakeArray" :todo="item" :key="item.id"
            :class="{point:true, pointSelect: item.isSel }">
        </snake-point>
    </div>
</body>
<script type="text/javascript">
    Vue.component('snake-point', {
        props: ['todo'],
        template: '<li>{{ todo.text }}</li>'
    })
    var thisSnake = new Vue({
        el: '#snakeId',
        data: {
            snakeArray: new Array(),
            snakeHead: null,
            snakeBoxSize: 30,
            snakePointWidth: 30,
            snakeBoxStyle: "",
            snakePointStyle: "",
            snakeMove: 39,// 37 左 38 上 39 右 40 下
            snakeEats: -1,// 果子
            snakeLen: 1,// 蛇的长度
            wallMap: [


            69,70,
            99,100,
            124,125,126,127,128,129,130,131,132,133,134,135,
            154,155,156,157,158,159,160,161,162,163,164,165,
            189,190,
            219,220,
            246,247,248,249,250,251,252,253,
            276,277,278,279,280,281,282,283,

            366,367,368,369,370,371,372,373,
            396,397,398,399,400,401,402,403,
            426,427,
            432,433,
            456,457,458,459,460,461,462,463,
            486,487,488,489,490,491,492,493,
            519,520,
            549,550,

            574,575,576,577,578,579,580,581,582,583,584,585,
            604,605,606,607,608,609,610,611,612,613,614,615,
            639,640,
            669,670,
            696,697,698,699,700,701,702,703,
            726,727,728,729,730,731,732,733,
            756,757,
            762,763,
            786,787,788,789,790,791,792,793,
            816,817,818,819,820,821,822,823,

        ]
        },
        methods: {
            snakeNode: function (idx) {
                this.pointIndex = idx;
                this.next = null;
            },
            copyWall: function () {
                var thisSnake = this;
                var wallMap = new Array();
                for (var i = 0; i < thisSnake.wallMap.length; i++) {
                    wallMap.push(thisSnake.wallMap[i]+10);
                }
                for (var i = 0; i < wallMap.length; i++) {
                    thisSnake.wallMap.push(wallMap[i]);
                }
            },
            showWall: function () {
                var thisSnake = this;
                for (var i = 0; i < thisSnake.wallMap.length; i++) {
                    thisSnake.snakeArray[thisSnake.wallMap[i]].isSel = true;
                }
            },
            isInWall: function (idx) {
                var thisSnake = this;
                if (thisSnake.wallMap.includes(idx)) {
                    return true;
                }
                return false;
            },
            insertNode: function (idx) {
                var thisSnake = this;
                var newNode = new thisSnake.snakeNode(idx);
                var pNode = thisSnake.snakeHead;
                var currNode = thisSnake.snakeHead;
                if (currNode.next != null) {
                    newNode.next = currNode.next;
                    pNode.next = newNode;
                } else {
                    currNode.next = newNode;
                }
                //console.log(this.snakeHead);
            },
            showNode: function () {
                var thisSnake = this;
                var currNode = thisSnake.snakeHead;
                while (currNode.next != null) {
                    currNode = currNode.next;
                    //console.log(currNode.pointIndex);
                    thisSnake.snakeArray[currNode.pointIndex].isSel = true;
                }
            },
            removeNode: function () {
                var thisSnake = this;
                var currNode = thisSnake.snakeHead;
                var frontNode = currNode;
                while (currNode.next != null) {
                    frontNode = currNode;
                    currNode = currNode.next;
                }
                // if(thisSnake.isInWall(currNode.pointIndex)){

                //     return;
                // }
                if (frontNode != this.snakeHead) {
                    var pointIndex = frontNode.next.pointIndex;
                    frontNode.next = null
                    thisSnake.snakeArray[pointIndex].isSel = false;
                }
            },
            snakeMoving: function () {
                var thisSnake = this;

                if (this.snakeEats != -1) {
                    // 显示果子
                    thisSnake.snakeArray[this.snakeEats].isSel = true;
                } else {
                    thisSnake.newSnakeEats();
                    thisSnake.snakeArray[this.snakeEats].isSel = true;
                }

                var index = thisSnake.snakeHead.next.pointIndex;
                switch (this.snakeMove) {
                    case 37:
                        if (index % thisSnake.snakeBoxSize == 0) {
                            index = index + thisSnake.snakeBoxSize - 1
                        } else {
                            index--;
                        }
                        break;
                    case 38:
                        if (index - thisSnake.snakeBoxSize < 0) {
                            index = thisSnake.snakeBoxSize * thisSnake.snakeBoxSize + index - thisSnake.snakeBoxSize;
                        } else {
                            index -= thisSnake.snakeBoxSize;
                        }
                        break;
                    case 39:
                        if ((index + 1) % thisSnake.snakeBoxSize == 0) {
                            index = index - (thisSnake.snakeBoxSize - 1);
                        } else {
                            index++;
                        }
                        break;
                    case 40:
                        if (index + thisSnake.snakeBoxSize > thisSnake.snakeBoxSize * thisSnake.snakeBoxSize - 1) {
                            index = index - thisSnake.snakeBoxSize * thisSnake.snakeBoxSize + thisSnake.snakeBoxSize;
                        } else {
                            index += thisSnake.snakeBoxSize;
                        }
                        break;
                    default:
                        break;
                }
                thisSnake.insertNode(index);
                // 判断是否吃到果子
                if (thisSnake.snakeEats == index) {
                    thisSnake.snakeEats = -1;
                } else {
                    thisSnake.removeNode();
                }

                thisSnake.showNode();
                thisSnake.showWall();
            },
            newSnakeEats: function () {
                var thisSnake = this;
                thisSnake.snakeEats = parseInt(thisSnake.snakeBoxSize * thisSnake.snakeBoxSize * Math.random());
            },
            listKeyDownEvent: function () {
                // 按键事件
                var thisSnake = this;
                document.onkeydown = function (e) {
                    var keyCode = window.event ? e.keyCode : e.which;
                    switch (keyCode) {
                        case 37:
                        case 39:
                            if (thisSnake.snakeMove != 37 && thisSnake.snakeMove != 39) {
                                thisSnake.snakeMove = keyCode;
                            }
                            break;
                        case 38:
                        case 40:
                            if (thisSnake.snakeMove != 38 && thisSnake.snakeMove != 40) {
                                thisSnake.snakeMove = keyCode;
                            }
                            break;
                        default:
                            console.log(keyCode)
                            break;
                    }
                }
            }
        },
        created: function () {
            var thisSnake = this;
            for (var i = 0; i < thisSnake.snakeBoxSize * thisSnake.snakeBoxSize; i++) {
                thisSnake.snakeArray.push({
                    id: i,
                    text: i+',',
                    isSel: false
                });
                thisSnake.snakeBoxStyle = "border:1px solid red;width: " +
                    thisSnake.snakePointWidth * thisSnake.snakeBoxSize +
                    "px;height: " + thisSnake.snakePointWidth * thisSnake.snakeBoxSize + "px;";
                thisSnake.snakePointStyle = "width: " + (thisSnake.snakePointWidth - 2) + "px;height: " + (thisSnake.snakePointWidth - 2) + "px;";
            }
            thisSnake.snakeHead = new thisSnake.snakeNode(0);
            for (var i = 0; i < thisSnake.snakeLen; i++) {
                thisSnake.insertNode(i+thisSnake.snakeBoxSize*5);
            }
            // thisSnake.newSnakeEats();
            thisSnake.copyWall()
            thisSnake.listKeyDownEvent();
            setInterval(thisSnake.snakeMoving, 100);

        },
    })
</script>

</html>